<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Mock Generator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
    
    <style>
        :root { --primary: #4f46e5; --primary-hover: #4338ca; --bg: #f3f4f6; --text: #1f2937; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; max-width: 850px; margin: 0 auto; padding: 2rem 1rem; background-color: var(--bg); color: var(--text); line-height: 1.6; }
        
        .container { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; margin-bottom: 0.5rem; font-size: 2rem; font-weight: 800; color: #111827; }
        .subtitle { text-align: center; color: #6b7280; margin-bottom: 2rem; font-size: 1.05rem; }

        /* ğŸ›¡ï¸ ë³´ì•ˆ ì„¤ëª… ë°°ë„ˆ (ë³µêµ¬ë¨) */
        .security-card {
            background: linear-gradient(to right, #eff6ff, #ffffff);
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 15px;
            align-items: start;
        }
        .security-icon { font-size: 2rem; margin-top: -5px; }
        .security-content h4 { margin: 0 0 0.5rem 0; color: #1e3a8a; font-size: 1.1rem; }
        .security-content p { margin: 0; font-size: 0.95rem; color: #334155; line-height: 1.5; }
        .security-highlight { color: var(--primary); font-weight: 700; background: #e0e7ff; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }

        /* ğŸ’¡ ê¿€íŒ í† ê¸€ */
        .tip-toggle { text-align: right; margin-bottom: 10px; }
        .tip-btn { background: none; border: none; color: #6b7280; cursor: pointer; font-size: 0.9rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }
        .tip-btn:hover { color: var(--primary); }
        
        .tip-box { background: #fffbeb; border: 1px solid #fcd34d; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; display: none; }
        .tip-box.show { display: block; animation: fadeIn 0.3s; }
        .tip-item { margin-bottom: 1rem; border-bottom: 1px dashed #fcd34d; padding-bottom: 1rem; }
        .tip-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .tip-title { font-weight: 700; color: #92400e; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px; }
        .tip-content { font-size: 0.9rem; color: #78350f; line-height: 1.5; }
        .code-snippet { background: rgba(255,255,255,0.6); padding: 2px 6px; border-radius: 4px; font-family: monospace; font-weight: bold; }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-container { display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 1.5rem; }
        .tab-btn { flex: 1; padding: 1rem; border: none; background: none; font-size: 1rem; font-weight: 700; color: #9ca3af; cursor: pointer; transition: 0.2s; border-bottom: 3px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); background: #eff6ff; }
        .tab-btn:hover:not(.active) { color: #4b5563; background-color: #f9fafb; }

        /* ì…ë ¥ ì˜ì—­ */
        .input-area { display: none; }
        .input-area.active { display: block; animation: fadeIn 0.3s ease-out; }
        
        textarea { width: 100%; height: 250px; padding: 1rem; border: 1px solid #d1d5db; border-radius: 8px; font-family: 'Menlo', monospace; font-size: 0.85rem; resize: vertical; box-sizing: border-box; background-color: #f8fafc; line-height: 1.4; }
        textarea:focus { outline: none; border-color: var(--primary); ring: 2px solid var(--primary); background-color: #fff; }

        /* ê²½ê³  ë°•ìŠ¤ */
        .warning-box { background: #fef2f2; border: 1px solid #fecaca; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; font-size: 0.9rem; color: #991b1b; display: flex; gap: 10px; align-items: center; }

        /* ê³µí†µ UI */
        .step-box { border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .label { font-weight: 700; display: block; margin-bottom: 0.5rem; color: #374151; }
        
        select, input[type="number"], input[type="file"] { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem; margin-bottom: 0.5rem; box-sizing: border-box; transition: 0.2s; }
        select:focus, input:focus { outline: none; border-color: var(--primary); ring: 2px solid var(--primary); }
        
        .helper-text { font-size: 0.85rem; color: #6b7280; margin-bottom: 0; margin-top: 4px; }
        
        button.main-btn { width: 100%; background-color: var(--primary); color: white; padding: 0.9rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button.main-btn:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        button.main-btn:disabled { background-color: #9ca3af; cursor: not-allowed; transform: none; }

        /* Rainbow Syntax */
        pre { background: #1e1e1e; color: #d4d4d4; padding: 1.5rem; border-radius: 12px; overflow-y: auto; max-height: 500px; font-size: 0.9rem; font-family: 'Menlo', 'Monaco', monospace; line-height: 1.5; border: 1px solid #333; }
        pre::-webkit-scrollbar { width: 10px; }
        pre::-webkit-scrollbar-track { background: #1e1e1e; }
        pre::-webkit-scrollbar-thumb { background: #444; border-radius: 5px; }
        .json-key { color: #9cdcfe; } .json-string { color: #ce9178; } .json-number { color: #b5cea8; } .json-boolean { color: #569cd6; } .json-null { color: #569cd6; }

        .btn-group { display: flex; gap: 10px; margin-top: 1rem; }
        .sub-btn { flex: 1; padding: 0.8rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-copy { background: #e5e7eb; color: #374151; }
        .btn-copy:hover { background: #d1d5db; }
        .btn-down { background: var(--success); color: white; }
        .btn-down:hover { background: #059669; }
        .success-bg { background: #10b981 !important; color: white !important; }

        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ Secure Mock Generator</h1>
        <div class="subtitle">ì•ˆì „í•œ API ëª©ì—… ìƒì„±ê¸°</div>

        <div class="security-card">
            <div class="security-icon">ğŸ›¡ï¸</div>
            <div class="security-content">
                <h4>ì•ˆì‹¬í•˜ì„¸ìš”, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!</h4>
                <p>
                    ì‹œìŠ¤í…œ ë‚´ë¶€ì—ì„œ <span class="security-highlight">Description(ì„¤ëª…)</span>, <span class="security-highlight">Example(ì˜ˆì‹œ)</span> ë“± 
                    ë¯¼ê° ì •ë³´ëŠ” <strong>ëª¨ë‘ í•„í„°ë§í•˜ì—¬ ì œê±°</strong>í•©ë‹ˆë‹¤.<br>
                    AIì—ê²ŒëŠ” ì˜¤ì§ ë°ì´í„° ìƒì„±ì„ ìœ„í•œ <strong>'ìˆœìˆ˜ ê»ë°ê¸°(Schema)'</strong> ì •ë³´ë§Œ ì „ë‹¬ë˜ë¯€ë¡œ ë³´ì•ˆ ê±±ì • ì—†ì´ ì‚¬ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>

        <div class="tip-toggle">
            <button class="tip-btn" onclick="toggleTip()">ğŸ’¡ ì‚¬ìš© ê¿€íŒ & Swagger JSON ë‹¤ìš´ë²•</button>
        </div>

        <div class="tip-box" id="tipBox">
            <div class="tip-item">
                <div class="tip-title">ğŸ“ Swaggerì—ì„œ JSON(Example) ë³µì‚¬í•˜ëŠ” ë²•</div>
                <div class="tip-content">
                    Swagger UIì—ì„œ APIë¥¼ í´ë¦­í•œ í›„, <strong>Responses</strong> ì„¹ì…˜ì˜ <strong>Example Value</strong>ì— ìˆëŠ” JSONì„ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•˜ì„¸ìš”.<br>
                    ë³µì¡í•œ ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì „ì²´ë³´ë‹¤, í•„ìš”í•œ ë¶€ë¶„ë§Œ ë³µì‚¬í•´ì„œ [ì§ì ‘ ì…ë ¥] í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ë¹ ë¦…ë‹ˆë‹¤!
                </div>
            </div>
            <div class="tip-item">
                <div class="tip-title">ğŸ’¾ Swagger JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë²•</div>
                <div class="tip-content">
                    Swagger í˜ì´ì§€ ìƒë‹¨ ì œëª© ë°”ë¡œ ì•„ë˜ì— ì‘ì€ ë§í¬ <span class="code-snippet">/v3/api-docs</span> ë˜ëŠ” <span class="code-snippet">swagger.json</span> ë§í¬ê°€ ìˆìŠµë‹ˆë‹¤.<br>
                    í•´ë‹¹ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì›ë³¸ JSONì´ ë‚˜ì˜µë‹ˆë‹¤. <strong>[ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥]</strong> í•´ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”.
                </div>
            </div>
        </div>

        <div class="tab-container">
            <button class="tab-btn active" onclick="switchTab('manual')">ğŸ“ JSON ì§ì ‘ ì…ë ¥ (ì¶”ì²œ)</button>
            <button class="tab-btn" onclick="switchTab('file')">ğŸ“‚ Swagger íŒŒì¼ ì—…ë¡œë“œ</button>
        </div>

        <div id="manual-section" class="input-area active">
            <div class="step-box">
                <label class="label">
                    JSON ë°ì´í„°/ìŠ¤í‚¤ë§ˆ ë¶™ì—¬ë„£ê¸°
                </label>
                <textarea id="manualInput" placeholder='Swaggerì˜ "Example Value"ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.&#13;&#10;ì˜ˆì‹œ:&#13;&#10;{&#13;&#10;  "status": "OK",&#13;&#10;  "couponList": [ ... ]&#13;&#10;}' oninput="detectSchemaFromManual()"></textarea>
                <div class="helper-text">â€» ê°ì²´({...})ë¥¼ ë„£ìœ¼ë©´ ë‚´ë¶€ ë°°ì—´ì„ ì±„ì›Œì£¼ê³ , ë°°ì—´([...])ì„ ë„£ìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</div>
            </div>
        </div>

        <div id="file-section" class="input-area">
            <div class="warning-box">
                <span>âš ï¸ <strong>ì£¼ì˜:</strong> í†µíŒŒì¼ ì—…ë¡œë“œ ì‹œ ì›ì¹˜ ì•ŠëŠ” ëŒ€ëŸ‰ì˜ ë°ì´í„°ê°€ ìƒì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>íŠ¹ì • APIë§Œ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ <strong>[ì§ì ‘ ì…ë ¥]</strong> íƒ­ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</span>
            </div>

            <div class="step-box">
                <label class="label">API ëª…ì„¸ì„œ íŒŒì¼ (.json, .yaml)</label>
                <input type="file" id="fileInput" accept=".json,.yaml,.yml">
                <button onclick="uploadFile()" id="uploadBtn" class="main-btn">ëª…ì„¸ì„œ ë¶„ì„í•˜ê¸°</button>
            </div>
            
            <div id="path-select-box" class="step-box hidden">
                <label class="label">API ê²½ë¡œ ì„ íƒ</label>
                <select id="pathSelect" onchange="detectSchemaFromFile()"></select>
            </div>
        </div>

        <div class="step-box">
            <label class="label">ìƒì„± ì˜µì…˜</label>
            
            <div style="margin-bottom: 1.5rem;">
                <div id="countLabel" style="font-size:0.95rem; font-weight:700; color:#374151;">
                    ë°°ì—´ ìƒì„± ê°œìˆ˜
                </div>
                <input type="number" id="countInput" value="5" min="1" max="50">
                
                <div id="countDesc" class="helper-text">
                    ë°°ì—´ì— ëŒ€í•œ ì¹´ìš´íŠ¸ ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>

            <button onclick="generateData()" id="genBtn" class="main-btn" disabled>âœ¨ AIë¡œ ëª©ì—… ë°ì´í„° ìƒì„±í•˜ê¸°</button>
        </div>

        <div id="resultArea" class="step-box hidden">
            <label class="label">ğŸ“¦ ìƒì„± ê²°ê³¼</label>
            <pre id="jsonOutput"></pre>
            
            <div class="btn-group">
                <button onclick="copyToClipboard()" id="copyBtn" class="sub-btn btn-copy">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
                <button onclick="downloadJson()" class="sub-btn btn-down">ğŸ’¾ JSON ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'manual';
        let fullSpec = null;
        let currentSchema = null;
        let rawJsonText = "";

        // íŒ í† ê¸€
        function toggleTip() {
            document.getElementById('tipBox').classList.toggle('show');
        }

        // íƒ­ ì „í™˜
        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.input-area').forEach(area => area.classList.remove('active'));

            if (mode === 'manual') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('manual-section').classList.add('active');
            } else {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('file-section').classList.add('active');
            }
            validateForm();
        }

        // ğŸ§  ìŠ¤ë§ˆíŠ¸ UI ì—…ë°ì´íŠ¸ (ìš”ì²­í•˜ì‹  ë¬¸êµ¬ ë°˜ì˜)
        function updateSchemaState(schema) {
            currentSchema = schema;
            const countLabel = document.getElementById('countLabel');
            const countDesc = document.getElementById('countDesc');
            
            // ë°°ì—´ ì—¬ë¶€ íŒë‹¨
            let isArray = false;
            if (schema.type === 'array') isArray = true;
            if (Array.isArray(schema)) isArray = true;

            if (isArray) {
                // ë°°ì—´ì¼ ë•Œ
                countLabel.innerText = "ë°°ì—´ ìƒì„± ê°œìˆ˜";
                countDesc.innerText = "ìƒì„±í•  ë¦¬ìŠ¤íŠ¸(Array)ì˜ ì•„ì´í…œ ê°œìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            } else {
                // ê°ì²´ì¼ ë•Œ (ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ìš©)
                countLabel.innerText = "ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ê°œìˆ˜";
                countDesc.innerText = "ê°ì²´(Object)ëŠ” 1ê°œë§Œ ìƒì„±ë˜ë©°, ë‚´ë¶€ì— í¬í•¨ëœ ë°°ì—´(List)ì˜ ë°ì´í„° ê°œìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            }
            validateForm();
        }

        function detectSchemaFromManual() {
            const text = document.getElementById('manualInput').value;
            try {
                const schema = JSON.parse(text);
                updateSchemaState(schema);
                document.getElementById('genBtn').disabled = false;
            } catch (e) {
                document.getElementById('genBtn').disabled = true;
            }
        }

        async function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            const btn = document.getElementById('uploadBtn');
            const orgText = btn.innerText;
            btn.innerText = "ğŸ”„ ë¶„ì„ ì¤‘..."; btn.disabled = true;
            const formData = new FormData(); formData.append('specFile', file);

            try {
                const res = await fetch('/api/parse', { method: 'POST', body: formData });
                const data = await res.json();
                if(data.error) throw new Error(data.error);
                fullSpec = data.spec;
                const select = document.getElementById('pathSelect'); select.innerHTML = '';
                data.paths.forEach(path => {
                    const option = document.createElement('option'); option.value = path; option.text = path; select.appendChild(option);
                });
                document.getElementById('path-select-box').classList.remove('hidden');
                detectSchemaFromFile();
            } catch (e) { alert("ì˜¤ë¥˜: " + e.message); } 
            finally { btn.innerText = orgText; btn.disabled = false; }
        }

        function detectSchemaFromFile() {
            const path = document.getElementById('pathSelect').value;
            if(!path || !fullSpec) return;
            const method = Object.keys(fullSpec.paths[path])[0];
            const responses = fullSpec.paths[path][method].responses;
            const successRes = responses['200'] || responses['201'] || Object.values(responses)[0];
            let schema = {};
            if (successRes?.content?.['application/json']?.schema) {
                schema = successRes.content['application/json'].schema;
            }
            updateSchemaState(schema);
        }

        function validateForm() {
            const btn = document.getElementById('genBtn');
            if (currentMode === 'file') btn.disabled = !currentSchema;
            else {
                try { JSON.parse(document.getElementById('manualInput').value); btn.disabled = false; } 
                catch(e) { btn.disabled = true; }
            }
        }

        async function generateData() {
            const count = parseInt(document.getElementById('countInput').value) || 1;
            let path = "Manual_Input"; let method = "POST";
            if (currentMode === 'file') {
                path = document.getElementById('pathSelect').value;
                method = Object.keys(fullSpec.paths[path])[0];
            }

            const btn = document.getElementById('genBtn');
            const output = document.getElementById('jsonOutput');
            btn.disabled = true; btn.innerText = "ğŸ¤– AIê°€ ë°ì´í„°ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...";
            document.getElementById('resultArea').classList.remove('hidden');
            output.innerHTML = '<span style="color:#aaa">â³ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</span>';
            setTimeout(() => document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' }), 100);

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path, method, specSchema: currentSchema, count })
                });
                const json = await res.json();
                if(json.error) throw new Error(json.error);
                rawJsonText = JSON.stringify(json, null, 2);
                output.innerHTML = syntaxHighlight(rawJsonText);
            } catch (e) { output.innerText = "âŒ ì‹¤íŒ¨: " + e.message; } 
            finally { btn.disabled = false; btn.innerText = "âœ¨ AIë¡œ ëª©ì—… ë°ì´í„° ìƒì„±í•˜ê¸°"; }
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) { cls = 'json-key'; } else { cls = 'json-string'; }
                } else if (/true|false/.test(match)) { cls = 'json-boolean'; } else if (/null/.test(match)) { cls = 'json-null'; }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        
        async function copyToClipboard() { 
            if (!rawJsonText) return; try { await navigator.clipboard.writeText(rawJsonText); const btn = document.getElementById('copyBtn'); const org = btn.innerText; btn.innerText = "âœ… ë³µì‚¬ ì™„ë£Œ!"; btn.classList.add('success-bg'); setTimeout(() => { btn.innerText = org; btn.classList.remove('success-bg'); }, 2000); } catch (err) {}
        }
        function downloadJson() { 
             if (!rawJsonText) return; const blob = new Blob([rawJsonText], { type: "application/json" }); const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = "mock_data.json"; link.click();
        }

        setInterval(() => { fetch('/health').catch(e=>{}); }, 10 * 60 * 1000);
    </script>
</body>
</html>