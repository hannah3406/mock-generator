<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Mock Generator</title>
    <style>
        :root { --primary: #4f46e5; --primary-hover: #4338ca; --bg: #f3f4f6; --text: #1f2937; --success: #10b981; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem 1rem; background-color: var(--bg); color: var(--text); line-height: 1.6; }
        
        .container { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); }
        
        h1 { text-align: center; margin-bottom: 0.5rem; font-size: 2rem; font-weight: 800; color: #111827; }
        .subtitle { text-align: center; color: #6b7280; margin-bottom: 2rem; font-size: 1.05rem; }
        
        /* ğŸ›¡ï¸ ë³´ì•ˆ ì„¤ëª… ë°°ë„ˆ (ì¹œì ˆí•œ ë²„ì „) */
        .security-card {
            background: linear-gradient(to right, #eff6ff, #ffffff);
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 15px;
            align-items: start;
        }
        .security-icon { font-size: 2rem; margin-top: -5px; }
        .security-content h4 { margin: 0 0 0.5rem 0; color: #1e3a8a; font-size: 1.1rem; }
        .security-content p { margin: 0; font-size: 0.95rem; color: #334155; line-height: 1.5; }
        .security-highlight { color: var(--primary); font-weight: 700; background: #e0e7ff; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }

        /* ğŸ’¡ ì‚¬ìš©ë²• í† ê¸€ ì„¹ì…˜ */
        .guide-toggle { text-align: right; margin-bottom: 1rem; }
        .guide-btn { background: none; border: none; color: #6b7280; cursor: pointer; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 5px; font-weight: 600; }
        .guide-btn:hover { color: var(--primary); }
        
        .guide-box {
            background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
        }
        .guide-box.show { display: block; animation: slideDown 0.3s ease-out; }
        .guide-step { display: flex; gap: 15px; margin-bottom: 1rem; }
        .guide-num { background: #94a3b8; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; flex-shrink: 0; margin-top: 3px; }
        .guide-text { font-size: 0.95rem; color: #475569; }

        /* ë©”ì¸ UI ìš”ì†Œë“¤ */
        .step-box { border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; transition: 0.2s; }
        .step-box:hover { border-color: #cbd5e1; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        
        .label { font-weight: 700; display: block; margin-bottom: 0.5rem; color: #374151; }
        select, input { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem; margin-bottom: 1rem; box-sizing: border-box; transition: 0.2s; }
        select:focus, input:focus { outline: none; border-color: var(--primary); ring: 2px solid var(--primary); }

        button.main-btn { width: 100%; background-color: var(--primary); color: white; padding: 0.9rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button.main-btn:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        button.main-btn:disabled { background-color: #9ca3af; cursor: not-allowed; transform: none; }

        /* ê²°ê³¼ì°½ */
        pre { background: #111827; color: #f3f4f6; padding: 1.5rem; border-radius: 12px; overflow-y: auto; max-height: 450px; font-size: 0.9rem; font-family: 'Menlo', monospace; border: 1px solid #374151; }
        pre::-webkit-scrollbar { width: 8px; }
        pre::-webkit-scrollbar-track { background: #1f2937; }
        pre::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }

        .btn-group { display: flex; gap: 10px; margin-top: 1rem; }
        .sub-btn { flex: 1; padding: 0.8rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-copy { background: #e5e7eb; color: #374151; }
        .btn-copy:hover { background: #d1d5db; }
        .btn-down { background: var(--success); color: white; }
        .btn-down:hover { background: #059669; }
        .success-bg { background: #10b981 !important; color: white !important; }

        .hidden { display: none; }
        .warning-text { color: var(--danger); font-size: 0.9rem; margin-top: -0.5rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 5px; font-weight: 500; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ Secure Mock Generator</h1>
        <div class="subtitle">ì•ˆì „í•œ API ëª©ì—… ìƒì„±ê¸°</div>
        
        <div class="security-card">
            <div class="security-icon">ğŸ›¡ï¸</div>
            <div class="security-content">
                <h4>ì•ˆì‹¬í•˜ì„¸ìš”, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!</h4>
                <p>
                    ì—¬ëŸ¬ë¶„ì´ ì—…ë¡œë“œí•œ Swagger/OpenAPI ëª…ì„¸ì„œëŠ” AIì—ê²Œ ê·¸ëŒ€ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                    ì‹œìŠ¤í…œ ë‚´ë¶€ì—ì„œ <span class="security-highlight">Title(ì œëª©)</span>, <span class="security-highlight">Description(ì„¤ëª…)</span>, <span class="security-highlight">Example(ì˜ˆì‹œ)</span> ë“± 
                    ë¯¼ê°í•  ìˆ˜ ìˆëŠ” ì •ë³´ëŠ” <strong>ëª¨ë‘ í•„í„°ë§í•˜ì—¬ ì œê±°</strong>í•©ë‹ˆë‹¤.<br>
                    AIì—ê²ŒëŠ” ì˜¤ì§ ë°ì´í„° ìƒì„±ì„ ìœ„í•œ <strong>'ìˆœìˆ˜ ê»ë°ê¸°(Schema)'</strong> ì •ë³´ë§Œ ì „ë‹¬ë˜ë¯€ë¡œ ë³´ì•ˆ ê±±ì • ì—†ì´ ì‚¬ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>

        <div class="guide-toggle">
            <button class="guide-btn" onclick="toggleGuide()">
                ğŸ’¡ ì²˜ìŒì´ì‹ ê°€ìš”? ì‚¬ìš©ë²• ë³´ê¸°
            </button>
        </div>

        <div class="guide-box" id="guideBox">
            <div class="guide-step">
                <div class="guide-num">1</div>
                <div class="guide-text">ê°€ì§€ê³  ê³„ì‹  <strong>Swagger/OpenAPI íŒŒì¼(.json, .yaml)</strong>ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.</div>
            </div>
            <div class="guide-step">
                <div class="guide-num">2</div>
                <div class="guide-text">ì•„ë˜ <strong>[ëª…ì„¸ì„œ ì—…ë¡œë“œ]</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ íŒŒì¼ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.</div>
            </div>
            <div class="guide-step">
                <div class="guide-num">3</div>
                <div class="guide-text">ì›í•˜ëŠ” <strong>API ê²½ë¡œ</strong>ë¥¼ ì„ íƒí•˜ê³ , í•„ìš”í•œ <strong>ë°ì´í„° ê°œìˆ˜</strong>ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
            </div>
            <div class="guide-step">
                <div class="guide-num">4</div>
                <div class="guide-text"><strong>[ìƒì„±í•˜ê¸°]</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AIê°€ í•œêµ­ì–´ íŒ¨ì¹˜ëœ ë¦¬ì–¼í•œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤!</div>
            </div>
        </div>

        <div class="step-box">
            <label class="label">ğŸ“‚ API ëª…ì„¸ì„œ ì—…ë¡œë“œ</label>
            <input type="file" id="fileInput" accept=".json,.yaml,.yml">
            <button onclick="uploadFile()" id="uploadBtn" class="main-btn">ëª…ì„¸ì„œ ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div class="step-box hidden" id="step2">
            <label class="label">ğŸ¯ ì˜µì…˜ ì„¤ì •</label>
            
            <div style="margin-bottom: 1rem;">
                <div style="font-size:0.9rem; color:#6b7280; margin-bottom:4px;">API ê²½ë¡œ (Path)</div>
                <select id="pathSelect" onchange="detectSchemaType()"></select>
            </div>

            <div style="margin-bottom: 1rem;">
                <div style="font-size:0.9rem; color:#6b7280; margin-bottom:4px;">í•„ìš”í•œ ë°ì´í„° ê°œìˆ˜</div>
                <input type="number" id="countInput" value="1" min="1" max="50">
                <div id="countWarning" class="warning-text hidden">
                    âš ï¸ ê°ì²´(Object) íƒ€ì…ì€ êµ¬ì¡°ìƒ 1ê°œë§Œ ìƒì„±ë©ë‹ˆë‹¤.
                </div>
            </div>

            <button onclick="generateData()" id="genBtn" class="main-btn">âœ¨ AIë¡œ ëª©ì—… ë°ì´í„° ìƒì„±í•˜ê¸°</button>
        </div>

        <div class="step-box hidden" id="resultArea">
            <label class="label">ğŸ“¦ ìƒì„± ê²°ê³¼</label>
            <pre id="jsonOutput">ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</pre>
            
            <div class="btn-group">
                <button onclick="copyToClipboard()" id="copyBtn" class="sub-btn btn-copy">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
                <button onclick="downloadJson()" class="sub-btn btn-down">ğŸ’¾ JSON ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <script>
        // í† ê¸€ ê¸°ëŠ¥
        function toggleGuide() {
            const box = document.getElementById('guideBox');
            box.classList.toggle('show');
        }

        // --- ê¸°ì¡´ ë¡œì§ ìœ ì§€ ---
        let fullSpec = null;
        let currentSchema = null;

        async function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            
            const btn = document.getElementById('uploadBtn');
            const originalText = btn.innerText;
            btn.innerText = "ğŸ”„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append('specFile', file);

            try {
                const res = await fetch('/api/parse', { method: 'POST', body: formData });
                const data = await res.json();
                if(data.error) throw new Error(data.error);

                fullSpec = data.spec;
                const select = document.getElementById('pathSelect');
                select.innerHTML = '';
                
                data.paths.forEach(path => {
                    const option = document.createElement('option');
                    option.value = path;
                    option.text = path;
                    select.appendChild(option);
                });

                document.getElementById('step2').classList.remove('hidden');
                detectSchemaType(); 

            } catch (e) {
                alert("ì˜¤ë¥˜ ë°œìƒ: " + e.message);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function detectSchemaType() {
            const path = document.getElementById('pathSelect').value;
            if(!path || !fullSpec) return;

            const methods = fullSpec.paths[path];
            const method = Object.keys(methods)[0];
            const responses = methods[method].responses;
            const successRes = responses['200'] || responses['201'] || Object.values(responses)[0];
            
            let schema = {};
            if (successRes?.content?.['application/json']?.schema) {
                schema = successRes.content['application/json'].schema;
            }

            currentSchema = schema;
            const isArray = schema.type === 'array';

            const countInput = document.getElementById('countInput');
            const warning = document.getElementById('countWarning');

            if (isArray) {
                countInput.disabled = false;
                warning.classList.add('hidden');
            } else {
                countInput.value = 1;
                countInput.disabled = true;
                warning.classList.remove('hidden');
            }
        }

        async function generateData() {
            const path = document.getElementById('pathSelect').value;
            const method = Object.keys(fullSpec.paths[path])[0];
            const count = parseInt(document.getElementById('countInput').value) || 1;

            const btn = document.getElementById('genBtn');
            const output = document.getElementById('jsonOutput');
            
            btn.disabled = true;
            btn.innerText = "ğŸ¤– AIê°€ ì—´ì‹¬íˆ ë°ì´í„°ë¥¼ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤...";
            document.getElementById('resultArea').classList.remove('hidden');
            
            // ìŠ¤í¬ë¡¤ ì´ë™
            setTimeout(() => {
                document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
            }, 100);

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path, method, specSchema: currentSchema, count })
                });
                const json = await res.json();
                
                if(json.error) throw new Error(json.error);
                output.innerText = JSON.stringify(json, null, 2);
            } catch (e) {
                output.innerText = "âŒ ì‹¤íŒ¨: " + e.message;
            } finally {
                btn.disabled = false;
                btn.innerText = "âœ¨ AIë¡œ ëª©ì—… ë°ì´í„° ìƒì„±í•˜ê¸°";
            }
        }

        async function copyToClipboard() {
            const text = document.getElementById('jsonOutput').innerText;
            if (!text) return;

            try {
                await navigator.clipboard.writeText(text);
                const btn = document.getElementById('copyBtn');
                const originalText = btn.innerText;
                btn.innerText = "âœ… ë³µì‚¬ ì™„ë£Œ!";
                btn.classList.add('success-bg');

                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('success-bg');
                }, 2000);
            } catch (err) {
                alert('ë³µì‚¬ ì‹¤íŒ¨');
            }
        }

        function downloadJson() {
            const text = document.getElementById('jsonOutput').innerText;
            const blob = new Blob([text], { type: "application/json" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "mock_data.json";
            link.click();
        }
    </script>
</body>
</html>