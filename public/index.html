<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Mock Generator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
    
    <style>
        :root { --primary: #4f46e5; --primary-hover: #4338ca; --bg: #f3f4f6; --text: #1f2937; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; max-width: 850px; margin: 0 auto; padding: 2rem 1rem; background-color: var(--bg); color: var(--text); line-height: 1.6; }
        
        .container { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; margin-bottom: 0.5rem; font-size: 2rem; font-weight: 800; color: #111827; }
        .subtitle { text-align: center; color: #6b7280; margin-bottom: 2rem; font-size: 1.05rem; }

        /* ğŸ›¡ï¸ ë³´ì•ˆ ì„¤ëª… ë°°ë„ˆ */
        .security-card {
            background: linear-gradient(to right, #eff6ff, #ffffff);
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 15px;
            align-items: start;
        }
        .security-icon { font-size: 2rem; margin-top: -5px; }
        .security-content h4 { margin: 0 0 0.5rem 0; color: #1e3a8a; font-size: 1.1rem; }
        .security-content p { margin: 0; font-size: 0.95rem; color: #334155; line-height: 1.5; }
        .security-highlight { color: var(--primary); font-weight: 700; background: #e0e7ff; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }

        /* ğŸ’¡ ì‚¬ìš©ë²• í† ê¸€ */
        .guide-toggle { text-align: right; margin-bottom: 1rem; }
        .guide-btn { background: none; border: none; color: #6b7280; cursor: pointer; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 5px; font-weight: 600; }
        .guide-btn:hover { color: var(--primary); }
        
        .guide-box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; display: none; }
        .guide-box.show { display: block; animation: slideDown 0.3s ease-out; }
        .guide-step { display: flex; gap: 15px; margin-bottom: 1rem; }
        .guide-num { background: #94a3b8; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; flex-shrink: 0; margin-top: 3px; }
        .guide-text { font-size: 0.95rem; color: #475569; }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-container { display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 1.5rem; }
        .tab-btn { flex: 1; padding: 1rem; border: none; background: none; font-size: 1rem; font-weight: 600; color: #6b7280; cursor: pointer; transition: 0.2s; border-bottom: 3px solid transparent; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-btn:hover:not(.active) { color: #374151; background-color: #f9fafb; }

        /* ì…ë ¥ ì˜ì—­ */
        .input-area { display: none; }
        .input-area.active { display: block; animation: fadeIn 0.3s ease-out; }
        
        textarea { width: 100%; height: 200px; padding: 1rem; border: 1px solid #d1d5db; border-radius: 8px; font-family: 'Menlo', monospace; font-size: 0.9rem; resize: vertical; box-sizing: border-box; background-color: #f9fafb; }
        textarea:focus { outline: none; border-color: var(--primary); ring: 2px solid var(--primary); background-color: #fff; }

        /* ê³µí†µ UI */
        .step-box { border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .label { font-weight: 700; display: block; margin-bottom: 0.5rem; color: #374151; }
        
        select, input[type="number"], input[type="file"] { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem; margin-bottom: 1rem; box-sizing: border-box; }
        
        button.main-btn { width: 100%; background-color: var(--primary); color: white; padding: 0.9rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button.main-btn:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        button.main-btn:disabled { background-color: #9ca3af; cursor: not-allowed; }

        /* ğŸŒˆ Rainbow Syntax Highlighting */
        pre { background: #1e1e1e; color: #d4d4d4; padding: 1.5rem; border-radius: 12px; overflow-y: auto; max-height: 500px; font-size: 0.9rem; font-family: 'Menlo', 'Monaco', monospace; line-height: 1.5; border: 1px solid #333; }
        pre::-webkit-scrollbar { width: 10px; }
        pre::-webkit-scrollbar-track { background: #1e1e1e; }
        pre::-webkit-scrollbar-thumb { background: #444; border-radius: 5px; }
        
        .json-key { color: #9cdcfe; }       /* Key: Sky Blue */
        .json-string { color: #ce9178; }    /* String: Orange */
        .json-number { color: #b5cea8; }    /* Number: Green */
        .json-boolean { color: #569cd6; }   /* Boolean: Blue */
        .json-null { color: #569cd6; }      /* Null: Blue */

        .btn-group { display: flex; gap: 10px; margin-top: 1rem; }
        .sub-btn { flex: 1; padding: 0.8rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-copy { background: #e5e7eb; color: #374151; }
        .btn-down { background: var(--success); color: white; }
        .success-bg { background: #10b981 !important; color: white !important; }

        .hidden { display: none; }
        .warning-text { color: #ef4444; font-size: 0.9rem; margin-top: -0.5rem; margin-bottom: 1rem; font-weight: 600; display: flex; align-items: center; gap: 5px; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ Secure Mock Generator</h1>
        <div class="subtitle">íŒ€ì›ë“¤ê³¼ í•¨ê»˜ ì“°ëŠ” ì•ˆì „í•œ API ëª©ì—… ìƒì„±ê¸°</div>

        <div class="security-card">
            <div class="security-icon">ğŸ›¡ï¸</div>
            <div class="security-content">
                <h4>ì•ˆì‹¬í•˜ì„¸ìš”, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!</h4>
                <p>
                    ì‹œìŠ¤í…œ ë‚´ë¶€ì—ì„œ <span class="security-highlight">Description(ì„¤ëª…)</span>, <span class="security-highlight">Example(ì˜ˆì‹œ)</span> ë“± 
                    ë¯¼ê° ì •ë³´ëŠ” <strong>ëª¨ë‘ í•„í„°ë§í•˜ì—¬ ì œê±°</strong>í•©ë‹ˆë‹¤.<br>
                    AIì—ê²ŒëŠ” ì˜¤ì§ ë°ì´í„° ìƒì„±ì„ ìœ„í•œ <strong>'ìˆœìˆ˜ ê»ë°ê¸°(Schema)'</strong> ì •ë³´ë§Œ ì „ë‹¬ë˜ë¯€ë¡œ ë³´ì•ˆ ê±±ì • ì—†ì´ ì‚¬ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>

        <div class="guide-toggle">
            <button class="guide-btn" onclick="toggleGuide()">ğŸ’¡ ì²˜ìŒì´ì‹ ê°€ìš”? ì‚¬ìš©ë²• ë³´ê¸°</button>
        </div>

        <div class="guide-box" id="guideBox">
            <div class="guide-step">
                <div class="guide-num">1</div>
                <div class="guide-text"><strong>[Swagger íŒŒì¼]</strong> ë˜ëŠ” <strong>[JSON ìŠ¤í‚¤ë§ˆ]</strong>ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.</div>
            </div>
            <div class="guide-step">
                <div class="guide-num">2</div>
                <div class="guide-text">ì›í•˜ëŠ” <strong>API ê²½ë¡œ</strong>ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ìŠ¤í‚¤ë§ˆë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.</div>
            </div>
            <div class="guide-step">
                <div class="guide-num">3</div>
                <div class="guide-text"><strong>[ìƒì„±í•˜ê¸°]</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AIê°€ í•œêµ­ì–´ íŒ¨ì¹˜ëœ ë¦¬ì–¼í•œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤!</div>
            </div>
        </div>

        <div class="tab-container">
            <button class="tab-btn active" onclick="switchTab('file')">ğŸ“‚ Swagger íŒŒì¼ ì—…ë¡œë“œ</button>
            <button class="tab-btn" onclick="switchTab('manual')">ğŸ“ JSON ìŠ¤í‚¤ë§ˆ ì§ì ‘ ì…ë ¥</button>
        </div>

        <div id="file-section" class="input-area active">
            <div class="step-box">
                <label class="label">API ëª…ì„¸ì„œ íŒŒì¼ (.json, .yaml)</label>
                <input type="file" id="fileInput" accept=".json,.yaml,.yml">
                <button onclick="uploadFile()" id="uploadBtn" class="main-btn">ëª…ì„¸ì„œ ë¶„ì„í•˜ê¸°</button>
            </div>
            
            <div id="path-select-box" class="step-box hidden">
                <label class="label">API ê²½ë¡œ ì„ íƒ</label>
                <select id="pathSelect" onchange="detectSchemaFromFile()"></select>
            </div>
        </div>

        <div id="manual-section" class="input-area">
            <div class="step-box">
                <label class="label">
                    JSON ìŠ¤í‚¤ë§ˆ ì…ë ¥
                    <span style="font-size:0.8rem; color:#6b7280; font-weight:normal;">(type: object ë˜ëŠ” array í˜•íƒœ)</span>
                </label>
                <textarea id="manualInput" placeholder='Example:
{
  "type": "object",
  "properties": {
    "username": { "type": "string" },
    "age": { "type": "integer" }
  }
}' oninput="detectSchemaFromManual()"></textarea>
            </div>
        </div>

        <div class="step-box">
            <label class="label">ìƒì„± ì˜µì…˜</label>
            <div style="margin-bottom: 1rem;">
                <div style="font-size:0.9rem; color:#6b7280; margin-bottom:4px;">ìƒì„± ê°œìˆ˜</div>
                <input type="number" id="countInput" value="1" min="1" max="50">
                <div id="countWarning" class="warning-text hidden">
                    âš ï¸ ê°ì²´(Object) íƒ€ì…ì€ êµ¬ì¡°ìƒ 1ê°œë§Œ ìƒì„±ë©ë‹ˆë‹¤.
                </div>
            </div>
            <button onclick="generateData()" id="genBtn" class="main-btn" disabled>âœ¨ AIë¡œ ëª©ì—… ë°ì´í„° ìƒì„±í•˜ê¸°</button>
        </div>

        <div id="resultArea" class="step-box hidden">
            <label class="label">ğŸ“¦ ìƒì„± ê²°ê³¼</label>
            <pre id="jsonOutput"></pre>
            <div class="btn-group">
                <button onclick="copyToClipboard()" id="copyBtn" class="sub-btn btn-copy">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
                <button onclick="downloadJson()" class="sub-btn btn-down">ğŸ’¾ JSON ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <script>
        // --- ê¸°ëŠ¥ ë¡œì§ ---
        let currentMode = 'file';
        let fullSpec = null;
        let currentSchema = null;
        let rawJsonText = "";

        function toggleGuide() {
            document.getElementById('guideBox').classList.toggle('show');
        }

        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.input-area').forEach(area => area.classList.remove('active'));

            if (mode === 'file') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('file-section').classList.add('active');
            } else {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('manual-section').classList.add('active');
            }
            validateForm();
        }

        async function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            
            const btn = document.getElementById('uploadBtn');
            const originalText = btn.innerText;
            btn.innerText = "ğŸ”„ ë¶„ì„ ì¤‘...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append('specFile', file);

            try {
                const res = await fetch('/api/parse', { method: 'POST', body: formData });
                const data = await res.json();
                if(data.error) throw new Error(data.error);

                fullSpec = data.spec;
                const select = document.getElementById('pathSelect');
                select.innerHTML = '';
                
                data.paths.forEach(path => {
                    const option = document.createElement('option');
                    option.value = path;
                    option.text = path;
                    select.appendChild(option);
                });

                document.getElementById('path-select-box').classList.remove('hidden');
                detectSchemaFromFile(); 

            } catch (e) {
                alert("ì˜¤ë¥˜: " + e.message);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function detectSchemaFromFile() {
            const path = document.getElementById('pathSelect').value;
            if(!path || !fullSpec) return;

            const methods = fullSpec.paths[path];
            const method = Object.keys(methods)[0];
            const responses = methods[method].responses;
            const successRes = responses['200'] || responses['201'] || Object.values(responses)[0];
            
            let schema = {};
            if (successRes?.content?.['application/json']?.schema) {
                schema = successRes.content['application/json'].schema;
            }
            updateSchemaState(schema);
        }

        function detectSchemaFromManual() {
            const text = document.getElementById('manualInput').value;
            try {
                const schema = JSON.parse(text);
                updateSchemaState(schema);
            } catch (e) {
                document.getElementById('genBtn').disabled = true;
            }
        }

        function updateSchemaState(schema) {
            currentSchema = schema;
            const isArray = schema.type === 'array';
            const countInput = document.getElementById('countInput');
            const warning = document.getElementById('countWarning');

            if (isArray) {
                countInput.disabled = false;
                warning.classList.add('hidden');
            } else {
                countInput.value = 1;
                countInput.disabled = true;
                warning.classList.remove('hidden');
            }
            validateForm();
        }

        function validateForm() {
            const btn = document.getElementById('genBtn');
            if (currentMode === 'file') {
                btn.disabled = !currentSchema;
            } else {
                try {
                    JSON.parse(document.getElementById('manualInput').value);
                    btn.disabled = false;
                } catch(e) {
                    btn.disabled = true;
                }
            }
        }

        async function generateData() {
            const count = parseInt(document.getElementById('countInput').value) || 1;
            let path = "Manual_Input";
            let method = "POST";

            if (currentMode === 'file') {
                path = document.getElementById('pathSelect').value;
                method = Object.keys(fullSpec.paths[path])[0];
            }

            const btn = document.getElementById('genBtn');
            const output = document.getElementById('jsonOutput');
            
            btn.disabled = true;
            btn.innerText = "ğŸ¤– AIê°€ ë°ì´í„°ë¥¼ êµ½ëŠ” ì¤‘...";
            document.getElementById('resultArea').classList.remove('hidden');
            output.innerHTML = '<span style="color:#aaa">â³ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</span>';

            setTimeout(() => {
                document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
            }, 100);

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path, method, specSchema: currentSchema, count })
                });
                const json = await res.json();
                
                if(json.error) throw new Error(json.error);
                
                rawJsonText = JSON.stringify(json, null, 2);
                output.innerHTML = syntaxHighlight(rawJsonText);

            } catch (e) {
                output.innerText = "âŒ ì‹¤íŒ¨: " + e.message;
            } finally {
                btn.disabled = false;
                btn.innerText = "âœ¨ AIë¡œ ëª©ì—… ë°ì´í„° ìƒì„±í•˜ê¸°";
            }
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) { cls = 'json-key'; } 
                    else { cls = 'json-string'; }
                } else if (/true|false/.test(match)) { cls = 'json-boolean'; }
                else if (/null/.test(match)) { cls = 'json-null'; }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        async function copyToClipboard() {
            if (!rawJsonText) return;
            try {
                await navigator.clipboard.writeText(rawJsonText);
                const btn = document.getElementById('copyBtn');
                const originalText = btn.innerText;
                btn.innerText = "âœ… ë³µì‚¬ ì™„ë£Œ!";
                btn.classList.add('success-bg');
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('success-bg');
                }, 2000);
            } catch (err) { alert('ë³µì‚¬ ì‹¤íŒ¨'); }
        }

        function downloadJson() {
            if (!rawJsonText) return;
            const blob = new Blob([rawJsonText], { type: "application/json" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "mock_data.json";
            link.click();
        }
    </script>
</body>
</html>